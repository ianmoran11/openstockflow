<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to openstockflow ‚Ä¢ openstockflow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Atkinson_Hyperlegible-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to openstockflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openstockflow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ianmoran11/openstockflow" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to openstockflow</h1>
                        <h4 data-toc-skip class="author">Ian Moran</h4>
            
            <h4 data-toc-skip class="date">2025-12-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ianmoran11/openstockflow/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><strong>openstockflow</strong> is the first R package to implement
categorical stock-flow modeling using decorated cospans and functorial
semantics. This approach, pioneered in the StockFlow.jl Julia package,
enables compositional model building where complex systems are assembled
from simpler components through categorical operations.</p>
<div class="section level3">
<h3 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a>
</h3>
<ul>
<li>
<strong>Compositional modeling</strong>: Build complex models from
simple components</li>
<li>
<strong>Functorial semantics</strong>: Formal separation of diagram
syntax from ODE semantics</li>
<li>
<strong>Dual API</strong>: Traditional pipe-based and algebraic
categorical notation</li>
<li>
<strong>Integration</strong>: Seamless integration with deSolve for
ODE solving</li>
<li>
<strong>Visualization</strong>: Multiple visualization options
including ggraph and Graphviz</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from GitHub (when available)</span></span>
<span><span class="co"># devtools::install_github("ianmoran/openstockflow")</span></span>
<span></span>
<span><span class="co"># For now, load from source</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ianmoran11/openstockflow" class="external-link">openstockflow</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-concepts">Basic Concepts<a class="anchor" aria-label="anchor" href="#basic-concepts"></a>
</h2>
<div class="section level3">
<h3 id="stock-flow-diagrams">Stock-Flow Diagrams<a class="anchor" aria-label="anchor" href="#stock-flow-diagrams"></a>
</h3>
<p>A <strong>stock-flow diagram</strong> consists of:</p>
<ul>
<li>
<strong>Stocks</strong> (rectangles): State variables representing
accumulations</li>
<li>
<strong>Flows</strong> (thick arrows): Rate processes that move
quantities between stocks</li>
<li>
<strong>Links</strong> (thin arrows): Information dependencies</li>
<li>
<strong>Variables</strong>: Auxiliary computations and
aggregations</li>
</ul>
</div>
<div class="section level3">
<h3 id="mathematical-foundation">Mathematical Foundation<a class="anchor" aria-label="anchor" href="#mathematical-foundation"></a>
</h3>
<p>Stock-flow diagrams are functors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>:</mo><mi>H</mi><mo>‚Üí</mo><mrow><mi>ùêÖ</mi><mi>ùê¢</mi><mi>ùêß</mi><mi>ùêí</mi><mi>ùêû</mi><mi>ùê≠</mi></mrow></mrow><annotation encoding="application/x-tex">F: H \to \mathbf{FinSet}</annotation></semantics></math>
from a primitive category
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>
to finite sets, where:</p>
<ul>
<li>Objects:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mtext mathvariant="normal">stock</mtext><mo>,</mo><mtext mathvariant="normal">flow</mtext><mo>,</mo><mtext mathvariant="normal">link</mtext><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\text{stock}, \text{flow}, \text{link}\}</annotation></semantics></math>
</li>
<li>Morphisms:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>,</mo><mi>d</mi><mo>:</mo><mtext mathvariant="normal">flow</mtext><mo>‚Üí</mo><mtext mathvariant="normal">stock</mtext></mrow><annotation encoding="application/x-tex">u, d: \text{flow} \to \text{stock}</annotation></semantics></math>
(upstream/downstream) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>:</mo><mtext mathvariant="normal">link</mtext><mo>‚Üí</mo><mtext mathvariant="normal">stock</mtext></mrow><annotation encoding="application/x-tex">s: \text{link} \to \text{stock}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>:</mo><mtext mathvariant="normal">link</mtext><mo>‚Üí</mo><mtext mathvariant="normal">flow</mtext></mrow><annotation encoding="application/x-tex">t: \text{link} \to \text{flow}</annotation></semantics></math>
</li>
</ul>
<p>The <strong>ODE semantics</strong> for a stock
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÉ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>œÉ</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><munder><mo>‚àë</mo><mrow><mi>f</mi><mo>‚àà</mo><mi>F</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>d</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>œÉ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><msub><mi>œï</mi><mi>f</mi></msub><mo>‚àí</mo><munder><mo>‚àë</mo><mrow><mi>f</mi><mo>‚àà</mo><mi>F</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>œÉ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><msub><mi>œï</mi><mi>f</mi></msub></mrow><annotation encoding="application/x-tex">\frac{d\sigma}{dt} = \sum_{f \in F(d)^{-1}(\sigma)} \phi_f - \sum_{f \in F(u)^{-1}(\sigma)} \phi_f</annotation></semantics></math></p>
<p>That is: rate of change = inflows - outflows.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-1-sir-epidemic-model">Example 1: SIR Epidemic Model<a class="anchor" aria-label="anchor" href="#example-1-sir-epidemic-model"></a>
</h2>
<p>The classic SIR (Susceptible-Infected-Recovered) model divides a
population into three compartments.</p>
<div class="section level3">
<h3 id="traditional-api">Traditional API<a class="anchor" aria-label="anchor" href="#traditional-api"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock_flow_diagram.html">stock_flow_diagram</a></span><span class="op">(</span>reset_ids <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_stock.html">add_stock</a></span><span class="op">(</span><span class="st">"S"</span>, initial <span class="op">=</span> <span class="fl">999</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_stock.html">add_stock</a></span><span class="op">(</span><span class="st">"I"</span>, initial <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_stock.html">add_stock</a></span><span class="op">(</span><span class="st">"R"</span>, initial <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_flow.html">add_flow</a></span><span class="op">(</span><span class="st">"infection"</span>,</span>
<span>    from <span class="op">=</span> <span class="st">"S"</span>,</span>
<span>    to <span class="op">=</span> <span class="st">"I"</span>,</span>
<span>    rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">beta</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">S</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">I</span> <span class="op">/</span> <span class="fl">1000</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_flow.html">add_flow</a></span><span class="op">(</span><span class="st">"recovery"</span>,</span>
<span>    from <span class="op">=</span> <span class="st">"I"</span>,</span>
<span>    to <span class="op">=</span> <span class="st">"R"</span>,</span>
<span>    rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">gamma</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">I</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># View diagram structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sir</span><span class="op">)</span></span>
<span><span class="co">#&gt; StockFlowDiagram</span></span>
<span><span class="co">#&gt;   Stocks: 3 </span></span>
<span><span class="co">#&gt;   Flows: 2 </span></span>
<span><span class="co">#&gt;   Links: 4 </span></span>
<span><span class="co">#&gt;   Variables: 0 </span></span>
<span><span class="co">#&gt;   Sum variables: 0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="algebraic-api">Algebraic API<a class="anchor" aria-label="anchor" href="#algebraic-api"></a>
</h3>
<p>The same model using categorical notation:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define stocks</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock.html">stock</a></span><span class="op">(</span><span class="st">"S"</span>, initial <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock.html">stock</a></span><span class="op">(</span><span class="st">"I"</span>, initial <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock.html">stock</a></span><span class="op">(</span><span class="st">"R"</span>, initial <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define flows</span></span>
<span><span class="va">infection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span><span class="st">"infection"</span>,</span>
<span>  rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">params</span><span class="op">$</span><span class="va">beta</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">S</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">I</span> <span class="op">/</span> <span class="fl">1000</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">recovery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flow.html">flow</a></span><span class="op">(</span><span class="st">"recovery"</span>,</span>
<span>  rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">params</span><span class="op">$</span><span class="va">gamma</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">I</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build diagram using %-&gt;% and %+%</span></span>
<span><span class="va">sir_alg</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op"><a href="../reference/grapes-plus-grapes.html">%+%</a></span> <span class="va">I</span> <span class="op"><a href="../reference/grapes-plus-grapes.html">%+%</a></span> <span class="va">R</span> <span class="op"><a href="../reference/grapes-plus-grapes.html">%+%</a></span></span>
<span>  <span class="op">(</span><span class="va">S</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%-&gt;%</a></span> <span class="va">infection</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%-&gt;%</a></span> <span class="va">I</span><span class="op">)</span> <span class="op"><a href="../reference/grapes-plus-grapes.html">%+%</a></span></span>
<span>  <span class="op">(</span><span class="va">I</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%-&gt;%</a></span> <span class="va">recovery</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%-&gt;%</a></span> <span class="va">R</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sir_diagram</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/finalize.html">finalize</a></span><span class="op">(</span><span class="va">sir_alg</span>, reset_ids <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot diagram structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export to Graphviz DOT format</span></span>
<span><span class="va">dot_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_graphviz.html">to_graphviz</a></span><span class="op">(</span><span class="va">sir</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">dot_str</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With ggraph (if installed)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sir</span>, layout <span class="op">=</span> <span class="st">"sugiyama"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"deSolve"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Solve ODE system</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve_diagram.html">solve_diagram</a></span><span class="op">(</span></span>
<span>    <span class="va">sir</span>,</span>
<span>    times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0.5</span>, gamma <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># View results</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Plot solution</span></span>
<span>  <span class="fu"><a href="../reference/plot_solution.html">plot_solution</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">‚Ñπ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="introduction_files/figure-html/sir_simulate-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-2-seir-model-with-population-conservation">Example 2: SEIR Model with Population Conservation<a class="anchor" aria-label="anchor" href="#example-2-seir-model-with-population-conservation"></a>
</h2>
<p>The SEIR model adds an Exposed (E) compartment and uses a sum
variable to track total population.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock_flow_diagram.html">stock_flow_diagram</a></span><span class="op">(</span>reset_ids <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_stock.html">add_stock</a></span><span class="op">(</span><span class="st">"S"</span>, initial <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_stock.html">add_stock</a></span><span class="op">(</span><span class="st">"E"</span>, initial <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_stock.html">add_stock</a></span><span class="op">(</span><span class="st">"I"</span>, initial <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_stock.html">add_stock</a></span><span class="op">(</span><span class="st">"R"</span>, initial <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_sum_variable.html">add_sum_variable</a></span><span class="op">(</span><span class="st">"N"</span>, stocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_flow.html">add_flow</a></span><span class="op">(</span><span class="st">"infection"</span>,</span>
<span>    from <span class="op">=</span> <span class="st">"S"</span>,</span>
<span>    to <span class="op">=</span> <span class="st">"E"</span>,</span>
<span>    rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">beta</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">S</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">I</span> <span class="op">/</span> <span class="va">inputs</span><span class="op">$</span><span class="va">N</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_flow.html">add_flow</a></span><span class="op">(</span><span class="st">"progression"</span>,</span>
<span>    from <span class="op">=</span> <span class="st">"E"</span>,</span>
<span>    to <span class="op">=</span> <span class="st">"I"</span>,</span>
<span>    rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">sigma</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">E</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_flow.html">add_flow</a></span><span class="op">(</span><span class="st">"recovery"</span>,</span>
<span>    from <span class="op">=</span> <span class="st">"I"</span>,</span>
<span>    to <span class="op">=</span> <span class="st">"R"</span>,</span>
<span>    rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">gamma</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">I</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"N"</span>, to <span class="op">=</span> <span class="st">"infection"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"I"</span>, to <span class="op">=</span> <span class="st">"infection"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">seir</span><span class="op">)</span></span>
<span><span class="co">#&gt; StockFlowDiagram</span></span>
<span><span class="co">#&gt;   Stocks: 4 </span></span>
<span><span class="co">#&gt;   Flows: 3 </span></span>
<span><span class="co">#&gt;   Links: 8 </span></span>
<span><span class="co">#&gt;   Variables: 0 </span></span>
<span><span class="co">#&gt;   Sum variables: 1</span></span></code></pre></div>
<div class="section level3">
<h3 id="seir-simulation">SEIR Simulation<a class="anchor" aria-label="anchor" href="#seir-simulation"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"deSolve"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">seir_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve_diagram.html">solve_diagram</a></span><span class="op">(</span></span>
<span>    <span class="va">seir</span>,</span>
<span>    times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0.5</span>, sigma <span class="op">=</span> <span class="fl">0.2</span>, gamma <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Verify population conservation</span></span>
<span>  <span class="va">total_pop</span> <span class="op">&lt;-</span> <span class="va">seir_result</span><span class="op">$</span><span class="va">S</span> <span class="op">+</span> <span class="va">seir_result</span><span class="op">$</span><span class="va">E</span> <span class="op">+</span> <span class="va">seir_result</span><span class="op">$</span><span class="va">I</span> <span class="op">+</span> <span class="va">seir_result</span><span class="op">$</span><span class="va">R</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Population conservation:"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">total_pop</span> <span class="op">-</span> <span class="fl">1001</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-6</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Plot dynamics</span></span>
<span>  <span class="fu"><a href="../reference/plot_solution.html">plot_solution</a></span><span class="op">(</span><span class="va">seir_result</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Phase plot</span></span>
<span>  <span class="fu"><a href="../reference/phase_plot.html">phase_plot</a></span><span class="op">(</span><span class="va">seir_result</span>, <span class="st">"S"</span>, <span class="st">"I"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Population conservation: TRUE</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/seir_simulate-1.png" class="r-plt" alt="" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-3-stock-and-flow-with-inflowsoutflows">Example 3: Stock and Flow with Inflows/Outflows<a class="anchor" aria-label="anchor" href="#example-3-stock-and-flow-with-inflowsoutflows"></a>
</h2>
<p>A water tank with constant inflow and proportional outflow.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock_flow_diagram.html">stock_flow_diagram</a></span><span class="op">(</span>reset_ids <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_stock.html">add_stock</a></span><span class="op">(</span><span class="st">"Water"</span>, initial <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_flow.html">add_flow</a></span><span class="op">(</span><span class="st">"fill"</span>,</span>
<span>    from <span class="op">=</span> <span class="cn">NULL</span>,  <span class="co"># NULL indicates inflow from outside</span></span>
<span>    to <span class="op">=</span> <span class="st">"Water"</span>,</span>
<span>    rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">inflow_rate</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_flow.html">add_flow</a></span><span class="op">(</span><span class="st">"drain"</span>,</span>
<span>    from <span class="op">=</span> <span class="st">"Water"</span>,</span>
<span>    to <span class="op">=</span> <span class="cn">NULL</span>,  <span class="co"># NULL indicates outflow to outside</span></span>
<span>    rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">outflow_rate</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">Water</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tank</span><span class="op">)</span></span>
<span><span class="co">#&gt; StockFlowDiagram</span></span>
<span><span class="co">#&gt;   Stocks: 1 </span></span>
<span><span class="co">#&gt;   Flows: 2 </span></span>
<span><span class="co">#&gt;   Links: 2 </span></span>
<span><span class="co">#&gt;   Variables: 0 </span></span>
<span><span class="co">#&gt;   Sum variables: 0</span></span></code></pre></div>
<p>At equilibrium, inflow = outflow:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">inflow_rate</mtext><mo>=</mo><mtext mathvariant="normal">outflow_rate</mtext><mo>√ó</mo><mtext mathvariant="normal">Water</mtext></mrow><annotation encoding="application/x-tex">\text{inflow\_rate} = \text{outflow\_rate} \times \text{Water}</annotation></semantics></math></p>
<p>So:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">Water</mtext><mtext mathvariant="normal">eq</mtext></msub><mo>=</mo><mfrac><mtext mathvariant="normal">inflow_rate</mtext><mtext mathvariant="normal">outflow_rate</mtext></mfrac></mrow><annotation encoding="application/x-tex">\text{Water}_{\text{eq}} = \frac{\text{inflow\_rate}}{\text{outflow\_rate}}</annotation></semantics></math></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"deSolve"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tank_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve_diagram.html">solve_diagram</a></span><span class="op">(</span></span>
<span>    <span class="va">tank</span>,</span>
<span>    times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>inflow_rate <span class="op">=</span> <span class="fl">10</span>, outflow_rate <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Equilibrium should be 10 / 0.1 = 100</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Final water level:"</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">tank_result</span><span class="op">$</span><span class="va">Water</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Expected equilibrium:"</span>, <span class="fl">10</span> <span class="op">/</span> <span class="fl">0.1</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/plot_solution.html">plot_solution</a></span><span class="op">(</span><span class="va">tank_result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Final water level: 99.6631 </span></span>
<span><span class="co">#&gt; Expected equilibrium: 100</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/tank_simulate-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level2">
<h2 id="example-4-auxiliary-variables">Example 4: Auxiliary Variables<a class="anchor" aria-label="anchor" href="#example-4-auxiliary-variables"></a>
</h2>
<p>Models can include auxiliary variables that depend on stocks or other
variables.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model with intermediate computation</span></span>
<span><span class="va">growth_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock_flow_diagram.html">stock_flow_diagram</a></span><span class="op">(</span>reset_ids <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_stock.html">add_stock</a></span><span class="op">(</span><span class="st">"Population"</span>, initial <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_variable.html">add_variable</a></span><span class="op">(</span><span class="st">"GrowthRate"</span>,</span>
<span>    expression <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">params</span>, <span class="va">var_values</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Growth rate decreases as population approaches carrying capacity</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">r</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">state</span><span class="op">[</span><span class="st">"Population"</span><span class="op">]</span> <span class="op">/</span> <span class="va">params</span><span class="op">$</span><span class="va">K</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_flow.html">add_flow</a></span><span class="op">(</span><span class="st">"growth"</span>,</span>
<span>    from <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    to <span class="op">=</span> <span class="st">"Population"</span>,</span>
<span>    rate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">inputs</span>, <span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">inputs</span><span class="op">$</span><span class="va">GrowthRate</span> <span class="op">*</span> <span class="va">inputs</span><span class="op">$</span><span class="va">Population</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"GrowthRate"</span>, to <span class="op">=</span> <span class="st">"growth"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_link.html">add_link</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"Population"</span>, to <span class="op">=</span> <span class="st">"growth"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">growth_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; StockFlowDiagram</span></span>
<span><span class="co">#&gt;   Stocks: 1 </span></span>
<span><span class="co">#&gt;   Flows: 1 </span></span>
<span><span class="co">#&gt;   Links: 3 </span></span>
<span><span class="co">#&gt;   Variables: 1 </span></span>
<span><span class="co">#&gt;   Sum variables: 0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="workflow-summary">Workflow Summary<a class="anchor" aria-label="anchor" href="#workflow-summary"></a>
</h2>
<p>The typical workflow with openstockflow is:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Define the model structure</strong></p>
<ul>
<li>Stocks: state variables</li>
<li>Flows: rate processes</li>
<li>Variables: auxiliary computations</li>
<li>Links: dependencies</li>
</ul>
</li>
<li>
<p><strong>Generate ODE system</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ode_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_ode.html">generate_ode</a></span><span class="op">(</span><span class="va">diagram</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Solve with deSolve</strong></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve_diagram.html">solve_diagram</a></span><span class="op">(</span><span class="va">diagram</span>, <span class="va">times</span>, <span class="va">params</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Visualize and analyze</strong></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">diagram</span><span class="op">)</span>        <span class="co"># Structure</span></span>
<span><span class="fu"><a href="../reference/plot_solution.html">plot_solution</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>  <span class="co"># Dynamics</span></span>
<span><span class="fu"><a href="../reference/phase_plot.html">phase_plot</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>  <span class="co"># State space</span></span></code></pre></div>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="design-principles">Design Principles<a class="anchor" aria-label="anchor" href="#design-principles"></a>
</h2>
<div class="section level3">
<h3 id="compositional-by-design">Compositional by Design<a class="anchor" aria-label="anchor" href="#compositional-by-design"></a>
</h3>
<p>Stock-flow diagrams are represented as functors, enabling:</p>
<ul>
<li>
<strong>Local reasoning</strong>: Understand components
independently</li>
<li>
<strong>Categorical composition</strong>: Combine models via
decorated cospans</li>
<li>
<strong>Stratification</strong>: Refine models via pullbacks (e.g.,
by age, sex)</li>
</ul>
</div>
<div class="section level3">
<h3 id="type-safety">Type Safety<a class="anchor" aria-label="anchor" href="#type-safety"></a>
</h3>
<p>S4 classes with validation ensure:</p>
<ul>
<li>Stocks have finite initial values</li>
<li>Flows connect to existing stocks</li>
<li>Dependencies are well-formed</li>
</ul>
</div>
<div class="section level3">
<h3 id="functional-semantics">Functional Semantics<a class="anchor" aria-label="anchor" href="#functional-semantics"></a>
</h3>
<p>The separation of syntax (diagram) and semantics (ODE) allows:</p>
<ul>
<li>Different interpretations (stochastic, discrete, etc.)</li>
<li>Formal verification of properties</li>
<li>Automated model transformations</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="mathematical-guarantees">Mathematical Guarantees<a class="anchor" aria-label="anchor" href="#mathematical-guarantees"></a>
</h2>
<div class="section level3">
<h3 id="population-conservation">Population Conservation<a class="anchor" aria-label="anchor" href="#population-conservation"></a>
</h3>
<p>When modeling conserved quantities (like total population), sum
variables ensure conservation:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagram</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_sum_variable.html">add_sum_variable</a></span><span class="op">(</span><span class="st">"Total"</span>, stocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The ODE system automatically satisfies:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Total</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\frac{d(\text{Total})}{dt} = 0</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="equilibrium-analysis">Equilibrium Analysis<a class="anchor" aria-label="anchor" href="#equilibrium-analysis"></a>
</h3>
<p>At equilibrium, all derivatives are zero:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚àë</mo><msub><mtext mathvariant="normal">inflows</mtext><mi>œÉ</mi></msub><mo>=</mo><mo>‚àë</mo><msub><mtext mathvariant="normal">outflows</mtext><mi>œÉ</mi></msub><mspace width="1.0em"></mspace><mo>‚àÄ</mo><mi>œÉ</mi></mrow><annotation encoding="application/x-tex">\sum \text{inflows}_\sigma = \sum \text{outflows}_\sigma \quad \forall \sigma</annotation></semantics></math></p>
<p>Use <code><a href="../reference/solve_diagram.html">solve_diagram()</a></code> to find equilibria numerically.</p>
</div>
</div>
<div class="section level2">
<h2 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a>
</h2>
<p>For large models:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Pre-compile</strong>: Generate ODE function once, reuse
for multiple simulations</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ode_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_ode.html">generate_ode</a></span><span class="op">(</span><span class="va">diagram</span><span class="op">)</span></span>
<span><span class="co"># Use ode_func multiple times with different params</span></span></code></pre></div>
</li>
<li><p><strong>Vectorization</strong>: Flow rate functions should use
vectorized operations</p></li>
<li><p><strong>Sparse systems</strong>: Use appropriate ODE solver
methods (future: compiled C code)</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong>Composition</strong>: Learn to compose models via decorated
cospans (future vignette)</li>
<li>
<strong>Stratification</strong>: Refine models by age, sex, or other
dimensions (future vignette)</li>
<li>
<strong>tidygraph integration</strong>: Work with diagrams as
tbl_graph objects (future vignette)</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Baez, J. C., Li, X., Libkind, S., Osgood, N., &amp; Redekopp, E.
(2022). ‚ÄúCompositional Modeling with Stock and Flow Diagrams.‚Äù
arXiv:2205.08373.</p></li>
<li><p>Libkind, S., Baas, A., Halter, M., Patterson, E., &amp;
Fairbanks, J. (2022). ‚ÄúA Categorical Framework for Modeling with Stock
and Flow Diagrams.‚Äù arXiv:2211.01290.</p></li>
<li><p>StockFlow.jl: Compositional Stock and Flow Modeling in Julia <a href="https://github.com/AlgebraicJulia/StockFlow.jl" class="external-link uri">https://github.com/AlgebraicJulia/StockFlow.jl</a></p></li>
</ol>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] magrittr_2.0.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] crayon_1.5.3       vctrs_0.6.5        cli_3.6.5          knitr_1.51        </span></span>
<span><span class="co">#&gt;  [5] rlang_1.1.6        xfun_0.55          generics_0.1.4     S7_0.2.1          </span></span>
<span><span class="co">#&gt;  [9] textshaping_1.0.4  jsonlite_2.0.0     deSolve_1.40       labeling_0.4.3    </span></span>
<span><span class="co">#&gt; [13] glue_1.8.0         htmltools_0.5.9    ragg_1.5.0         sass_0.4.10       </span></span>
<span><span class="co">#&gt; [17] scales_1.4.0       rmarkdown_2.30     grid_4.5.2         tibble_3.3.0      </span></span>
<span><span class="co">#&gt; [21] evaluate_1.0.5     jquerylib_0.1.4    fastmap_1.2.0      yaml_2.3.12       </span></span>
<span><span class="co">#&gt; [25] lifecycle_1.0.4    compiler_4.5.2     dplyr_1.1.4        RColorBrewer_1.1-3</span></span>
<span><span class="co">#&gt; [29] fs_1.6.6           pkgconfig_2.0.3    farver_2.1.2       systemfonts_1.3.1 </span></span>
<span><span class="co">#&gt; [33] digest_0.6.39      R6_2.6.1           tidyselect_1.2.1   pillar_1.11.1     </span></span>
<span><span class="co">#&gt; [37] bslib_0.9.0        withr_3.0.2        tools_4.5.2        gtable_0.3.6      </span></span>
<span><span class="co">#&gt; [41] pkgdown_2.2.0      ggplot2_4.0.1      cachem_1.1.0       desc_1.4.3</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ian Moran.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
